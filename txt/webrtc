WebRTC 通讯过程不需要中间媒介（P2P）
两者进行连接当然是需要通过 IP + 端口进行连接，毕竟只有通过 IP 才能找到对应的设备

如果需要通讯的两台设备的网络环境是局域网，该如何建立连接？
如果通讯的两台设备建立连接后，无法解析对方的音视频格式该如何？

第一个问题可以通过内网映射（NAT）的方式解决； 第二个问题可以在连接之前先互相确定好双方支持的格式（一方支持 H264 和 VP8，另一方支持 H264 和 VP9，那么就可以在连接之前确定好双方的编解码格式是 H264 格式，此格式是双方都支持的）。

第二个问题 通过一台中间的服务器来传递双方的信息了（双方 NAT 后的 IP 和端口也可以通过此服务器进行传递）

############
############
所以基于以上问题，通讯过程可能如下：

用户 A 和 用户 B 通过 NAT 服务进行映射；
用户 A 和 用户 B 通过一台中间服务器进行交换各自支持的格式和映射后的 IP + 端口；
各自得知对方的信息后就可以开始连接通讯。


-------------------------
媒体协商（SDP）：两个用户在连接之前相互确定并交换双方支持的音视频格式的过程就是媒体协商。SDP 是描述信息的一种格式

网络协商（candidate）：两个用户在 NAT 后交换各自的网络信息的过程就是网络协商。candidate 也是一种描述信息的一种格式

信令服务器：传递双方信息的服务器就是信令服务器，此服务其实就是 web 服务，其职责也不止传输媒体格式以及网络信息，还可传输业务信息。其传输信息的协议可是 HTTP 或 Socket 等。

STUN：STUN 是一种网络协议，其目的是进行 NAT 穿越。

所以 STUN 的作用就是能够检测网络中是否存在 NAT 设备，有就可以获取到 NAT 分配的 IP + 端口地址，然后建立一条可穿越 NAT 的 P2P 连接（这一过程就是打洞）。

ICE 框架包含了以下几个步骤：
收集网络接口信息，包括本地 IP 地址、端口等；
通过 STUN 服务器获取公网 IP 地址和端口号；
通过 NAT 透明性检测来确定 NAT 类型和行为；
尝试直接连接对等端点；
如果直接连接失败，则使用 TURN 服务器作为中继节点进行连接。 也就是，ICE 更好的进行 NAT 穿越效果，从而提高实时通信的质量和效率。











